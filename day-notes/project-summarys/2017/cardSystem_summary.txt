## create at  2018.1.8
## 卡牌系统

一、卡牌升星
		卡牌升星对应的条件
			1、英雄碎片
			2、金币(升级所需的金币)
			3、等级(英雄的等级)
		说明：
			金币：每次升星都需要消耗不同数量的金币
			等级:不同的星数对应的卡牌的级别是不同的。
			例如：我的“黑暗牧师”从2星升级到3星。
				需要的碎片：60
				金币：75000
				英雄等级：10级
		判断：
			1、卡牌等级是否已经大于或者等级英雄等级
			2、玩家是否有这张卡牌
			3、玩家的升级金币数量
			4、玩家的卡牌碎片数量
			5、玩家的卡牌等级
		更改：
			1、玩家的卡牌等级++
			2、玩家消耗的金币数量
			3、玩家消耗的卡牌碎片数量
			Currency map[int32]int64  key:itemId value:count   key:消耗的道具id value:消耗的对应道具的数量
二、货币兑换
	1、钻石换金币
	2、金币换钻石
	3、钻石购买技能点
	总结：
		1、check condition:
			购买次数是否达到上限
			玩家的兑换币是否充足
		2、值变化
			减去相应地金币或者钻石
			添加相应地金币或者钻石
		3、在“钻石换金币”的时候，页面显示的金币，是经过公式计算之后的值，不是直接从表里面读取的值
三、升级技能点

需要做的，找到技能点

1、技能点的最大值的次数与哪儿些值有关系
	1.1、体力的最大值和团队等级有关系
	1.2、升级卡牌的技能点应该与玩家的vip等级有关系。
	    vip等级	 技能点个数			团队等级	体力的最大值
	     0-3			10				1~60		120
	     >=4			20			      60		150
	1.3、升级卡牌技能点和哪儿些值有关系
	check condition:(检查的条件)
		1.3.1、技能点有没有解锁
		1.3.2、是否有足够的金币
		1.3.3、是否有足够的钻石(钻石是用来购买技能点的)
		1.3.3、是否还有可操作的技能点
		1.3.4、技能点等级是否是当前卡牌的等级

	update value:(要改变的值)
		1.3.5、消耗的金币数量
		1.3.6、卡牌增加的战力值(购买相应地技能点，卡牌会增加对应地战力值)--牵扯到的问题---购买技能点，如何更改战力
		
问题：
	1、程序里面，固定写死的技能点在哪里写的????
	结论：这个技能点的最大值，是由前端控制的，后端只需要判断这个值是否为0就可以了
	程序在初始化用户数据的时候，从csv.CLevelMap中根据定义的常量从表中找出这个初始值
	
	体力的最大值是addTeamExp的时候，来进行判断的，如果玩家的经验超过了这个时候卡牌经验的最大值，那么就会给这个字段赋值。
体力的最大值服务器保存了，在player.Vigour这个字段里面,但是，技能点的最大值客户端自己判断了，没有让服务器保存。
	原因：体力是可以累加的，但是技能点是有上限的，不能累加。所以，技能点是客户端来判断的，体力的最值服务器需要保存。。
	vip等级	技能点最大值
	0~3			10
	60+			20
	
	终于找到了表示技能点常量的值在哪里存放了，原来实在skill_const.go里面
	SkillPointMaxLimit :技能点的最大值(vip>=4)
	SkillPointMaxLimixLow: 技能点的最小值(vip:0~3)
	SkillPointVIPLevel : 技能点达到这个vip的时候，技能点的最大值会发生变化。
	
	保存体力值的最大值在哪里？？？？？？？？？？？？？
		在初始化用户数据的时候，从csv.CLevelMap中根据定义的常量从表中找出这个初始值。		
		玩家的体力值上限是从配置表里面读取的。level.csv里面的Vigour_Max
	
	
	
	2、购买技能点是如何计算战力的
		这个是和卡牌的方法结合在一起的，已经封装好的，代用cardl.UpdateFp(player,Fp)
	3、卡培升级技能点为什么还有开锁？------------------未解决
	4、卡牌升级技能点和品质还有关系？------------------未解决
	
四、卡牌培养
卡牌培养



1、check condition
	1.1、培养次数:在一次或者十次
	1.2、培养消耗的培养石、钻石、金币是否足够
2、update card value
	2.1、血量、攻击、物防、魔防
	2.2、消耗的金币、钻石、培养丹
	2.3、记录对应卡牌的培养次数
3、卡牌培养的规则
	培养类型：普通、高级、高华
	培养次数：一次、十次
	初级培养		高级培养	豪华培养
	 培养丹		
	 培养丹	  	  金币 
	 培养丹				     钻石
		
		
		
		
疑问：
	1、在卡牌培养的时候，培养添加的属性，怎么是负数?
		
		原因：这个是从配置表里面读取的
	
		培养一次中，随机的添加的属性可能增加也可能减少----这个是随机分配的
		培养十次中，只获取随机增加的数值的总和。
		
		case1:如果这四个值都到达了最大值,那么，就会进入下一个培养阶段
		case2:在每一个培养阶段，每点击一次“培养十次”，增加的属性是从表里面读取的
		也就是说，在每一个培养阶段，“血量、攻击、物防、魔防”，都会有一个最大值。
		每次随机培养一次的时候，随机增长的值也是不同的
	2、如何判断一个卡牌是否可以培养？
		原因：我觉得应该是如果这个卡牌的四个属性每个都到了第五个培养阶段的最大值
		
		默认为true
		1、在检验某个卡牌是否可以培养的时候,可以创建一个bool值。一次检查玩家卡牌的这四个属性是否达到某一个阶段的上限
		如果没有达到，设置为false。
		2、如果这个bool类型的值为true,表示这个值全部达到了这个培养阶段的峰值，也就可以报错了
		
	3、培养时，每次随机的培养值该如何随机?
		原因：
			3.1、从CardFosterRule.csv里面获取对应的随机范围。
			3.2、遍历这个卡牌的四个属性,然后依次增加对应地值。
			3.3、card.FosterValue这个方法里面
		
		****************************************
				
				每次随机的数值,怎么计算
			
		****************************************
		
		在卡牌等级为一的时候，
			如果每次随机出来的buff和卡牌原来的相加，结果小于0，则取原来value的相反数，比如原来血量是2，培养一次之后，可能原来的血量要减去2。
			
	注意：	
		在正式应用的时候，如果经过运算之后的随机出的四个值都是负数，就会报错
				
	4、卡牌成长大师，该怎么判断
	5、在培养卡牌的时候，如果某个属性达到了最大值，比如“血量”，其他的还没有达到最大值，这个属性就不增加。当所有属性从一个阶段到另外一个阶段，
	所有属性的初始值就是上一个阶段的最大值。
	6、如何更新卡牌培养战力等级？
		在具体应用培养的时候，会重新添加一个接口，然后对这些数据进行处理。
		至于培养获取到的新的战力，经过一个方法的封装。
			6.1、将card.Foster.TempValue 赋值到 card.Foster.Value里面
			6.2、清空card.Foster.TempValue
			6.3、判断是否需要增加card.Foster.Level
			6.4、同样是调用mod.Card.Save(player,card) 这个方法可以更新战力。

	
	
FosterProterties   []int32 卡牌培养属性  
FosterLimit		   map[int32][]int32   				 key:卡牌培养阶段  value:每个阶段卡牌培养的上限
FosterSuitNeedFp	[]int32    						 卡牌培养大师每级别所需要的战力
FosterSuit			map[int32]map[int32]int32       key: 培养的战力等级   value:  (key:额外属性类型  value:额外属性值)


在 /card/foster中应用到的数据结构,
	FosterProterties:4/1/2/3  血量、攻击、物防、模仿。
	FosterLimit 	map[int32][]int32 		key: 阶段id  value:  每一个阶段，这几个培养属性的最大值。
/card/fosterapply


	
	  
	
	
		

	
疑问：
	1、比如在钻石购买金币的时候，页面显示的金币是经过公式计算之后的值
Diamond2Coin.csv里面,是根据玩家的购买次数，然后消耗不同的钻石，
在钻石换金币的时候，可能会有一个暴击。暴击的值是由相应地比例控制的。
	2、卡牌的技能点程序在哪里写死的
	3、升级卡牌技能走的是哪儿个接口  /card/upskill
	4、卡培升级技能点为什么还有开锁？------------------未解决
	5、卡牌升级技能点和品质还有关系？------------------未解决
	
	