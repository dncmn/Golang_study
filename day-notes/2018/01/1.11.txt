## day-notes
一、需要看的
	项目用到的新技术：
		1、ffjson
			就是快速对json序列化的一个工具。详情参考jjson.txt
		2、docker微服务
	项目：
		1、卡牌系统
			1.1、卡牌成长
			1.2、卡牌培养
二、bug fix
	1、升级时，体力恢复读错行--未解决
	
未解决：
	1、在卡牌培养的时候，有时候会出现培养一次或者培养十次出现服务器错误。
		原因是card.Foster.Value   []int32  这个字段是空的，里面连0都没有，所有在使用的时候会出现服务器错误。
	
	
	
三、总结
四、随手记
	



卡牌培养



1、check condition
	1.1、培养次数:在一次或者十次
	1.2、培养消耗的培养石、钻石、金币是否足够
2、update card value
	2.1、血量、攻击、物防、魔防
	2.2、消耗的金币、钻石、培养丹
	2.3、记录对应卡牌的培养次数
3、卡牌培养的规则
	培养类型：普通、高级、高华
	培养次数：一次、十次
	初级培养		高级培养	豪华培养
	 培养丹		
	 培养丹	  	  金币 
	 培养丹				     钻石
		
		
		
		
疑问：
	1、在卡牌培养的时候，培养添加的属性，怎么是负数?
		
		原因：这个是从配置表里面读取的
	
		培养一次中，随机的添加的属性可能增加也可能减少----这个是随机分配的
		培养十次中，只获取随机增加的数值的总和。
		
		case1:如果这四个值都到达了最大值,那么，就会进入下一个培养阶段
		case2:在每一个培养阶段，每点击一次“培养十次”，增加的属性是从表里面读取的
		也就是说，在每一个培养阶段，“血量、攻击、物防、魔防”，都会有一个最大值。
		每次随机培养一次的时候，随机增长的值也是不同的
	2、如何判断一个卡牌是否可以培养？
		原因：我觉得应该是如果这个卡牌的四个属性每个都到了第五个培养阶段的最大值
		
		默认为true
		1、在检验某个卡牌是否可以培养的时候,可以创建一个bool值。一次检查玩家卡牌的这四个属性是否达到某一个阶段的上限
		如果没有达到，设置为false。
		2、如果这个bool类型的值为true,表示这个值全部达到了这个培养阶段的峰值，也就可以报错了
		
	3、培养时，每次随机的培养值该如何随机?
		原因：
			3.1、从CardFosterRule.csv里面获取对应的随机范围。
			3.2、遍历这个卡牌的四个属性,然后依次增加对应地值。
			3.3、card.FosterValue这个方法里面
		
		****************************************
				
				每次随机的数值,怎么计算
			
		****************************************
		
		在卡牌等级为一的时候，
			如果每次随机出来的buff和卡牌原来的相加，结果小于0，则取原来value的相反数，比如原来血量是2，培养一次之后，可能原来的血量要减去2。
			
	注意：	
		在正式应用的时候，如果经过运算之后的随机出的四个值都是负数，就会报错
				
	4、卡牌成长大师，该怎么判断
	5、在培养卡牌的时候，如果某个属性达到了最大值，比如“血量”，其他的还没有达到最大值，这个属性就不增加。当所有属性从一个阶段到另外一个阶段，
	所有属性的初始值就是上一个阶段的最大值。
	6、如何更新卡牌培养战力等级？
		在具体应用培养的时候，会重新添加一个接口，然后对这些数据进行处理。
		至于培养获取到的新的战力，经过一个方法的封装。
			6.1、将card.Foster.TempValue 赋值到 card.Foster.Value里面
			6.2、清空card.Foster.TempValue
			6.3、判断是否需要增加card.Foster.Level
			6.4、同样是调用mod.Card.Save(player,card) 这个方法可以更新战力。
	
FosterProterties   []int32 卡牌培养属性  
FosterLimit		   map[int32][]int32   				 key:卡牌培养阶段  value:每个阶段卡牌培养的上限
FosterSuitNeedFp	[]int32    						 卡牌培养大师每级别所需要的战力
FosterSuit			map[int32]map[int32]int32       key: 培养的战力等级   value:  (key:额外属性类型  value:额外属性值)


在 /card/foster中应用到的数据结构,
	FosterProterties:4/1/2/3  血量、攻击、物防、模仿。
	FosterLimit 	map[int32][]int32 		key: 阶段id  value:  每一个阶段，这几个培养属性的最大值。
/card/fosterapply




EnchantNeedResource    map[int32]map[int32][]int32



type  CCardEnchant  struct{

	EnchantPlace int32     附魔位置  装备:1,2,3,4  首饰:5,6
	EnchantLevel int32     附魔等级  0~5,也就是1~6
}


卡牌附魔
	对于附魔而言,程序写的很简单
		1、check condition
			1.1、判断附魔的条件够不够
			1.2、有没有开启附魔
			1.3、附魔卡牌的id是否存在
			1.4、附魔等级是否在合适的范围
		2、update value
			2.1、card.enchant.Level
			2.2、cosume other resoure
			2.3、日常任务中,消耗的资源值
		3、武器和首饰都是可以附魔的
		
	
疑问：
	1、如何获取附魔资源
		直接从初始化的结构体中获取对应地值
	2、更给附魔影响的战力值
	3、如何区分首饰附魔和装备附魔
笔记：

Enchant             map[int32]map[int32]map[int32]int32 `csv:"-"` // 进阶附魔增加属性    属性位置->属性附魔等级->获得附魔类型->获得附魔数值
EnchantNeedResource map[int32]map[int32][]int32         `csv:"-"` // 进阶附魔所需资源    属性位置->属性附魔等级->所需资源 type|id|count
EnchantSkills       map[int32]map[int32][]int32         `csv:"-"` // 附魔技能           属性位置->属性附魔等级->技能列表





















































